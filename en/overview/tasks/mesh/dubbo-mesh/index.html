<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.109.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Dubbo proxy mesh using Envoy & Istio | Apache Dubbo</title><meta property="og:title" content="Dubbo proxy mesh using Envoy & Istio"><meta property="og:description" content="This example demonstrates how to use Istio+Envoy's Service Mesh deployment mode to develop a Dubbo3 service. The Dubbo3 service uses Triple as the communication protocol. The communication process is intercepted by the Envoy data plane, and Dubbo is managed using the standard Istio traffic management capability."><meta property="og:type" content="article"><meta property="og:url" content="https://dubbo.apache.org/en/overview/tasks/mesh/dubbo-mesh/"><meta property="article:section" content="overview"><meta property="article:modified_time" content="2023-01-02T18:31:02+08:00"><meta property="og:site_name" content="Apache Dubbo"><meta itemprop=name content="Dubbo proxy mesh using Envoy & Istio"><meta itemprop=description content="This example demonstrates how to use Istio+Envoy's Service Mesh deployment mode to develop a Dubbo3 service. The Dubbo3 service uses Triple as the communication protocol. The communication process is intercepted by the Envoy data plane, and Dubbo is managed using the standard Istio traffic management capability."><meta itemprop=dateModified content="2023-01-02T18:31:02+08:00"><meta itemprop=wordCount content="1518"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Dubbo proxy mesh using Envoy & Istio"><meta name=twitter:description content="This example demonstrates how to use Istio+Envoy's Service Mesh deployment mode to develop a Dubbo3 service. The Dubbo3 service uses Triple as the communication protocol. The communication process is intercepted by the Envoy data plane, and Dubbo is managed using the standard Istio traffic management capability."><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-112489517-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=preload href=/scss/main.min.8637cb48af1c2672dbf22e4e83652c0cebe2d667477b88c8a046be155bcf7cfe.css as=style><link href=/scss/main.min.8637cb48af1c2672dbf22e4e83652c0cebe2d667477b88c8a046be155bcf7cfe.css rel=stylesheet integrity><script src=/js/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/en/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 321.39 78.54"><title id="title19">DUBBO LOGO</title><path class="cls-1" d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25H68.46zm21.24-28h8.6V31H89.7zm0 22.25h8.6v8.6H89.7zM33.24 7.25H4.06v64H33.24c10.95.0 19.3-7.18 23.29-17.15a45.12 45.12.0 002.38-14.87A45.12 45.12.0 0056.53 24.4C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63H30.34a3.44 3.44.0 00-3.44 3.44V53.23a3.44 3.44.0 003.44 3.44h3.33v4.63h-8.3a6.87 6.87.0 01-6.87-6.87V24.12a6.87 6.87.0 016.87-6.87h8.3zM285.51 6.06c-17.05.0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21S302.56 6.06 285.51 6.06zm7.59 48.36a6.87 6.87.0 01-6.87 6.87h-8.3V56.67h3.33a3.44 3.44.0 003.44-3.44V25.31a3.44 3.44.0 00-3.44-3.44h-3.33V17.25h8.3a6.87 6.87.0 016.87 6.87zm-53.4-17.56A17.39 17.39.0 00227.31 7.25H195.1v64h32.21a19.44 19.44.0 0012.38-34.44zM211.63 61.29h-6.08l18.68-44h6.08zM177 36.85A17.39 17.39.0 00164.65 7.25H132.43v64h32.21A19.44 19.44.0 00177 36.85zM149 61.29h-6.08l18.68-44h6.08z" style="fill:#fff;fill-opacity:1"/></svg></span><span class="text-uppercase font-weight-bold">Apache Dubbo</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/en/overview/><span class=active>Overview</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/en/docs3-v2/><span>SDK Manual</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/en/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/en/release/><span>Releases</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/en/users/><span>Users</span></a></li><li class="nav-item dropdown d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/overview/tasks/mesh/dubbo-mesh/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div id=docsearch></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div id=docsearch></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/overview/tasks/mesh/dubbo-mesh/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-enoverview-li><a href=/en/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-enoverview><span>Overview</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-enoverviewwhat-li><a href=/en/overview/what/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewwhat><span>What is Dubbo</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewwhatoverview-li><a href=/en/overview/what/overview/ title="Introduction to Dubbo" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewwhatoverview><span>Introduction</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewwhatdubbo3-li><a href=/en/overview/what/dubbo3/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewwhatdubbo3><span>Dubbo 3 Quick Facts</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewwhatarchitecture-li><a href=/en/overview/what/architecture/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewwhatarchitecture><span>Architecture</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewwhatextensibility-li><a href=/en/overview/what/extensibility/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewwhatextensibility><span>Extensibility</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewwhatecosystem-li><a href=/en/overview/what/ecosystem/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewwhatecosystem><span>Ecosystem</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewwhatusecases-li><a href=/en/users/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewwhatusecases><span>Users</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-enoverviewquickstart-li><a href=/en/overview/quickstart/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewquickstart><span>Quick Start</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-enoverviewtasks-li><a href=/en/overview/tasks/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewtasks><span>Tasks</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-enoverviewtaskstraffic-management-li><a href=/en/overview/tasks/traffic-management/ title="Traffic Management" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewtaskstraffic-management><span>Traffic Governance</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstraffic-managementweight-li><a href=/en/overview/tasks/traffic-management/weight/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstraffic-managementweight><span>Adjust traffic distribution by weight</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstraffic-managementtimeout-li><a href=/en/overview/tasks/traffic-management/timeout/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstraffic-managementtimeout><span>Dynamic adjustment of service timeout</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstraffic-managementtraffic-routing-li><a href=/en/overview/tasks/traffic-management/traffic-routing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstraffic-managementtraffic-routing><span>Request Routing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstraffic-managementzone-li><a href=/en/overview/tasks/traffic-management/zone/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstraffic-managementzone><span>Same computer room/area priority</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstraffic-managementisolation-li><a href=/en/overview/tasks/traffic-management/isolation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstraffic-managementisolation><span>Temporarily kick out the problem service instance</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstraffic-managementtraffic-gray-li><a href=/en/overview/tasks/traffic-management/traffic-gray/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstraffic-managementtraffic-gray><span>Traffic Grayscale</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstraffic-managementtraffic-condition-li><a href=/en/overview/tasks/traffic-management/traffic-condition/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstraffic-managementtraffic-condition><span>Traffic Isolation</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-enoverviewtaskskubernetes-li><a href=/en/overview/tasks/kubernetes/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewtaskskubernetes><span>Kubernetes Deployment Solution</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskskubernetesdeploy-on-k8s-li><a href=/en/overview/tasks/kubernetes/deploy-on-k8s/ title="Deploying to Kubernetes" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskskubernetesdeploy-on-k8s><span>Native K8S Service based on API-SERVER</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-enoverviewtasksmesh-li><a href=/en/overview/tasks/mesh/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewtasksmesh><span>Mesh Deployment Solution</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-enoverviewtasksmeshdubbo-mesh-li><a href=/en/overview/tasks/mesh/dubbo-mesh/ title="Dubbo proxy mesh using Envoy & Istio" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-enoverviewtasksmeshdubbo-mesh><span class=td-sidebar-nav-active-item>Sidecar mode</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-enoverviewtasksmeshproxyless-li><a href=/en/overview/tasks/mesh/proxyless/ title="Istio + Proxyless" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtasksmeshproxyless><span>Proxyless mode</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-enoverviewtaskstriple-li><a href=/en/overview/tasks/triple/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewtaskstriple><span>Triple Usage Example</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstripleidl-li><a href=/en/overview/tasks/triple/idl/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstripleidl><span>Using IDL + Protobuf to define services across languages</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstriplewrap-li><a href=/en/overview/tasks/triple/wrap/ title="Pojo Serialization Compatibility Mode" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstriplewrap><span>Pojo serialization compatibility mode</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtaskstriplestreaming-li><a href=/en/overview/tasks/triple/streaming/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtaskstriplestreaming><span>Streaming communication mode</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-enoverviewtasksmigration-li><a href=/en/overview/tasks/migration/ title="How to smoothly migrate to the new functions of Dubbo3" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewtasksmigration><span>Migrate to Dubbo3</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtasksmigration2to3-li><a href=/en/overview/tasks/migration/2to3/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtasksmigration2to3><span>Upgrade to Dubbo3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtasksmigrationmigration-triple-li><a href=/en/overview/tasks/migration/migration-triple/ title="Guide to Migrating Dubbo Protocol to Triple Protocol" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtasksmigrationmigration-triple><span>Triple Protocol</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtasksmigrationservice-discovery-samples-li><a href=/en/overview/tasks/migration/service-discovery-samples/ title="Dubbo3 application-level service discovery" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtasksmigrationservice-discovery-samples><span>Application-Level Service Discovery</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-enoverviewtasksecosystem-li><a href=/en/overview/tasks/ecosystem/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewtasksecosystem><span>Microservice Governance</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtasksecosystemtransaction-li><a href=/en/overview/tasks/ecosystem/transaction/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtasksecosystemtransaction><span>Transaction Management</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewtasksecosystemrate-limit-li><a href=/en/overview/tasks/ecosystem/rate-limit/ title="Current Limit Downgrade" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewtasksecosystemrate-limit><span>Current limit downgrade</span></a></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-enoverviewmannual-li><a href=/en/overview/mannual/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-enoverviewmannual><span>SDK Manual</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewmannualjava-li><a href=/en/docs3-v2/java-sdk/ title="Java SDK" target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewmannualjava><span>Java</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewmannualgolang-li><a href=/en/docs3-v2/golang-sdk/ title="Golang SDK" target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewmannualgolang><span>Golang</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enoverviewmannualrust-li><a href=/en/docs3-v2/rust-sdk/ title="Rust SDK" target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-enoverviewmannualrust><span>Rust</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/apache/dubbo-website/edit/master/content/en/overview/tasks/mesh/dubbo-mesh.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/apache/dubbo-website/new/master/content/en/overview/tasks/mesh/dubbo-mesh.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/apache/dubbo-website/issues/new?title=Dubbo%20proxy%20mesh%20using%20Envoy%20&%20Istio" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/apache/dubbo/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#1-overall-objective>1 Overall Objective</a></li><li><a href=#2-basic-process-and-working-principle>2 Basic process and working principle</a></li><li><a href=#3-detailed-steps>3 detailed steps</a><ul><li><a href=#31-environmental-requirements>3.1 Environmental requirements</a></li><li><a href=#32-create-an-independent-namespace-and-enable-automatic-injection>3.2 Create an independent namespace and enable automatic injection</a></li><li><a href=#33-deploy-to-kubernetes>3.3 Deploy to Kubernetes</a></li><li><a href=#34-check-the-normal-communication-between-provider-and-consumer>3.4 Check the normal communication between Provider and Consumer</a></li><li><a href=#35-traffic-governance---virtualservice-implements-proportional-traffic-forwarding>3.5 Traffic Governance - VirtualService implements proportional traffic forwarding</a></li><li><a href=#36-view-dashboard>3.6 View dashboard</a></li></ul></li><li><a href=#4-modified-example>4 Modified Example</a></li><li><a href=#5-common-commands>5 Common commands</a></li><li><a href=#6-notes>6 Notes</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://dubbo.apache.org/en/overview/>Overview</a></li><li class=breadcrumb-item><a href=https://dubbo.apache.org/en/overview/tasks/>Tasks</a></li><li class=breadcrumb-item><a href=https://dubbo.apache.org/en/overview/tasks/mesh/>Mesh Deployment Solution</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://dubbo.apache.org/en/overview/tasks/mesh/dubbo-mesh/>Sidecar mode</a></li></ol></nav><div class=td-content><h1>Dubbo proxy mesh using Envoy & Istio</h1><div class=lead>This example demonstrates how to use Istio+Envoy&rsquo;s Service Mesh deployment mode to develop a Dubbo3 service. The Dubbo3 service uses Triple as the communication protocol. The communication process is intercepted by the Envoy data plane, and Dubbo is managed using the standard Istio traffic management capability.</div><header class=article-meta></header><p>By following the steps below, you can easily learn how to develop a Dubbo service that conforms to the Service Mesh architecture, deploy it to Kubernetes, and access Istio&rsquo;s traffic management system. Check here <a href=https://github.com/apache/dubbo-samples/tree/master/3-extensions/registry/dubbo-samples-mesh-k8s>Complete sample source code</a></p><h2 id=1-overall-objective>1 Overall Objective</h2><ul><li>Deploy Dubbo application to Kubernetes</li><li>Istio automatically injects Envoy and implements traffic interception</li><li>Traffic governance based on Istio rules</li></ul><h2 id=2-basic-process-and-working-principle>2 Basic process and working principle</h2><p>This example demonstrates how to deploy an application developed by Dubbo under the Istio system to realize Envoy&rsquo;s automatic proxying of Dubbo services. The overall architecture of the example is shown in the figure below.</p><p><img src=/imgs/v3/mesh/thinsdk-envoy.png alt=thinsdk></p><p>The steps you will need to complete the example are as follows:</p><ol><li>Create a Dubbo application ( <a href=https://github.com/apache/dubbo-samples/tree/master/3-extensions/registry/dubbo-samples-mesh-k8s>dubbo-samples-mesh-k8s</a> )</li><li>Build the container image and push it to the mirror warehouse (<a href=https://hub.docker.com/r/apache/dubbo-demo>the official image of this example</a> )</li><li>Deploy Dubbo Provider and Dubbo Consumer to Kubernetes respectively and verify that Envoy proxy injection is successful</li><li>Verify Envoy discovers the service address, normally intercepts RPC traffic and implements load balancing</li><li>Proportional traffic forwarding based on Istio VirtualService</li></ol><h2 id=3-detailed-steps>3 detailed steps</h2><h3 id=31-environmental-requirements>3.1 Environmental requirements</h3><p>Please ensure that the following environment is installed locally to provide container runtime, Kubernetes cluster and access tools</p><ul><li><a href=https://www.docker.com/get-started/>Docker</a></li><li><a href=https://minikube.sigs.k8s.io/docs/start/>Minikube</a></li><li><a href=https://kubernetes.io/docs/tasks/tools/>Kubectl</a></li><li><a href=https://istio.io/latest/docs/setup/getting-started/>Istio</a></li><li><a href=https://github.com/ahmetb/kubectx>Kubens(optional)</a></li></ul><p>Start the local Kubernetes cluster with the following command</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>minikube start
</span></span></code></pre></div><p>Check that the cluster is up and running with kubectl, and that kubectl is bound to the default local cluster</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info
</span></span></code></pre></div><h3 id=32-create-an-independent-namespace-and-enable-automatic-injection>3.2 Create an independent namespace and enable automatic injection</h3><p>Use the following command to create an independent Namespace <code>dubbo-demo</code> for the sample project, and enable sidecar automatic injection at the same time.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#586e75># Initialize the namespace</span>
</span></span><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/apache/dubbo-samples/master/3-extensions/registry/dubbo-samples-mesh-k8s/deploy/Namespace.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># switch namespace</span>
</span></span><span style=display:flex><span>kubens dubbo-demo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># dubbo-demo enable automatic injection</span>
</span></span><span style=display:flex><span>kubectl label namespace dubbo-demo istio-injection<span style=color:#719e07>=</span>enabled
</span></span></code></pre></div><h3 id=33-deploy-to-kubernetes>3.3 Deploy to Kubernetes</h3><h4 id=331-deploy-provider>3.3.1 Deploy Provider</h4><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#586e75># Deploy the Service</span>
</span></span><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/apache/dubbo-samples/master/3-extensions/registry/dubbo-samples-mesh-k8s/deploy/provider/Service.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># Deploy Deployment</span>
</span></span><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/apache/dubbo-samples/master/3-extensions/registry/dubbo-samples-mesh-k8s/deploy/provider/Deployment.yml
</span></span></code></pre></div><p>The above command creates a Service named <code>dubbo-samples-mesh-provider</code>, note that the service name here is the same as the dubbo application name in the project.</p><p>Then the Deployment deploys a 2-copy pod instance, and the Provider is started.</p><p>You can check the startup log with the following command.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#586e75># View pod list</span>
</span></span><span style=display:flex><span>kubectl get pods -l <span style=color:#268bd2>app</span><span style=color:#719e07>=</span>dubbo-samples-mesh-provider
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># View pod deployment logs</span>
</span></span><span style=display:flex><span>kubectl logs your-pod-id
</span></span></code></pre></div><p>At this time, there should be a dubbo provider container instance and an Envoy Sidecar container instance in the pod.</p><h4 id=332-deploy-consumer>3.3.2 Deploy Consumer</h4><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#586e75># Deploy the Service</span>
</span></span><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/apache/dubbo-samples/master/3-extensions/registry/dubbo-samples-mesh-k8s/deploy/consumer/Service.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># Deploy Deployment</span>
</span></span><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/apache/dubbo-samples/master/3-extensions/registry/dubbo-samples-mesh-k8s/deploy/consumer/Deployment.yml
</span></span></code></pre></div><p>Deploying consumer and provider is the same, here also keep K8S Service and Dubbo consumer application name (in [dubbo.properties](<a href=https://github.com/apache/dubbo-samples/blob/master/3-extensions/registry>https://github.com/apache/dubbo-samples/blob/master/3-extensions/registry</a> //dubbo-samples-mesh-k8s/dubbo-samples-mesh-consumer/src/main/resources/spring/dubbo-consumer.properties) consistent: <code>dubbo.application.name=dubbo-samples-mesh- consumer</code>.</p><blockquote><p>The provider service (application) name of consumption is also specified in the Dubbo Consumer service statement <code>@DubboReference(version = "1.0.0", providedBy = "dubbo-samples-mesh-provider", lazy = true)</code></p></blockquote><h3 id=34-check-the-normal-communication-between-provider-and-consumer>3.4 Check the normal communication between Provider and Consumer</h3><p>After performing step 3.3, check the startup log to see that the consumer has completed consumption of the provider service.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#586e75># View pod list</span>
</span></span><span style=display:flex><span>kubectl get pods -l <span style=color:#268bd2>app</span><span style=color:#719e07>=</span>dubbo-samples-mesh-consumer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># View pod deployment logs</span>
</span></span><span style=display:flex><span>kubectl logs your-pod-id
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># View pod isitio-proxy logs</span>
</span></span><span style=display:flex><span>kubectl logs your-pod-id -c istio-proxy
</span></span></code></pre></div><p>You can see that the consumer pod log output is as follows (the Triple protocol is load balanced by the Envoy proxy):</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>0</span> <span style=color:#268bd2>end</span> <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span>10/08/22 07:07:36:036 UTC<span style=color:#719e07>]</span> main INFO action.GreetingServiceConsumer: consumer Unary reply &lt;-message: <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.22:50052, client: 172.18. 96.22, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>1</span> <span style=color:#268bd2>end</span> <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span>10/08/22 07:07:42:042 UTC<span style=color:#719e07>]</span> main INFO action.GreetingServiceConsumer: consumer Unary reply &lt;-message: <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.18:50052, client: 172.18. 96.18, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span></code></pre></div><p>The consumer istio-proxy log output is as follows:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#719e07>[</span>2022-07-15T05:35:14.418Z<span style=color:#719e07>]</span> <span style=color:#2aa198>&#34;POST /org.apache.dubbo.samples.Greeter/greet HTTP/2&#34;</span> <span style=color:#2aa198>200</span>
</span></span><span style=display:flex><span>- via_upstream - <span style=color:#2aa198>&#34;-&#34;</span> <span style=color:#2aa198>19</span> <span style=color:#2aa198>160</span> <span style=color:#2aa198>2</span> <span style=color:#2aa198>1</span> <span style=color:#2aa198>&#34;-&#34;</span> <span style=color:#2aa198>&#34;-&#34;</span> <span style=color:#2aa198>&#34;6b8a5a03-5783-98bf-9bee-f93ea6e3d68e&#34;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>&#34;dubbo-samples-mesh-provider:50052&#34;</span> <span style=color:#2aa198>&#34;172.17.0.4:50052&#34;</span>
</span></span><span style=display:flex><span>outbound|50052<span style=color:#719e07>||</span>dubbo-samples-mesh-provider.dubbo-demo.svc.cluster.local 172.17.0.7:52768 10.101.172.129:50052 172.17.0.7:38488 - default
</span></span></code></pre></div><p>You can see the provider pod log output as follows:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#719e07>[</span>10/08/22 07:08:47:047 UTC<span style=color:#719e07>]</span> tri-protocol-50052-thread-8 INFO impl.GreeterImpl: Server <span style=color:#b58900>test</span> dubbo tri mesh received greet request name: <span style=color:#2aa198>&#34;service mesh&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span>10/08/22 07:08:57:057 UTC<span style=color:#719e07>]</span> tri-protocol-50052-thread-9 INFO impl.GreeterImpl: Server <span style=color:#b58900>test</span> dubbo tri mesh received greet request name: <span style=color:#2aa198>&#34;service mesh&#34;</span>
</span></span></code></pre></div><p>The log output of provider istio-proxy is as follows:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#719e07>[</span>2022-07-15T05:25:34.061Z<span style=color:#719e07>]</span> <span style=color:#2aa198>&#34;POST /org.apache.dubbo.samples.Greeter/greet HTTP/2&#34;</span> <span style=color:#2aa198>200</span>
</span></span><span style=display:flex><span>- via_upstream - <span style=color:#2aa198>&#34;-&#34;</span> <span style=color:#2aa198>19</span> <span style=color:#2aa198>162</span> <span style=color:#2aa198>1</span> <span style=color:#2aa198>1</span> <span style=color:#2aa198>&#34;-&#34;</span> <span style=color:#2aa198>&#34;-&#34;</span> <span style=color:#2aa198>&#34;201e6976-da10-96e1-8da7-ad032e58db47&#34;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>&#34;dubbo-samples-mesh-provider:50052&#34;</span> <span style=color:#2aa198>&#34;172.17.0.10:50052&#34;</span>
</span></span><span style=display:flex><span>  inbound|50052<span style=color:#719e07>||</span> 127.0.0.6:47013 172.17.0.10:50052 172.17.0.7:60244
</span></span><span style=display:flex><span>   outbound_.50052_._.dubbo-samples-mesh-provider.dubbo-demo.svc.cluster.local default
</span></span></code></pre></div><h3 id=35-traffic-governance---virtualservice-implements-proportional-traffic-forwarding>3.5 Traffic Governance - VirtualService implements proportional traffic forwarding</h3><p>Deploy the v2 version of the demo provider</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/apache/dubbo-samples/master/3-extensions/registry/dubbo-samples-mesh-k8s/deploy/provider/Deployment-v2.yml
</span></span></code></pre></div><p>Set VirtualService and DestinationRule, and observe that traffic is directed to provider v1 and provider v2 respectively in a ratio of 4:1.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/apache/dubbo-samples/master/3-extensions/registry/dubbo-samples-mesh-k8s/deploy/traffic/virtual-service.yml
</span></span></code></pre></div><p>From the log output of the consumer side, observe the traffic distribution effect as shown in the figure below:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>100</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>15</span><span style=color:#719e07>:</span><span style=color:#2aa198>58</span><span style=color:#719e07>:</span><span style=color:#2aa198>05</span><span style=color:#2aa198>8</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.18:50052, client: 172.18. 96.18, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>101</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>16</span><span style=color:#719e07>:</span><span style=color:#2aa198>03</span><span style=color:#719e07>:</span><span style=color:#2aa198>003</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.22:50052, client: 172.18. 96.22, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>102</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>16</span><span style=color:#719e07>:</span><span style=color:#2aa198>08</span><span style=color:#719e07>:</span><span style=color:#2aa198>00</span><span style=color:#2aa198>8</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.18:50052, client: 172.18. 96.18, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>103</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>16</span><span style=color:#719e07>:</span><span style=color:#2aa198>13</span><span style=color:#719e07>:</span><span style=color:#2aa198>013</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v2: 172.18.96.6:50052, client: 172.18. 96.6, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>104</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>16</span><span style=color:#719e07>:</span><span style=color:#2aa198>18</span><span style=color:#719e07>:</span><span style=color:#2aa198>01</span><span style=color:#2aa198>8</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.22:50052, client: 172.18. 96.22, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>105</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>16</span><span style=color:#719e07>:</span><span style=color:#2aa198>24</span><span style=color:#719e07>:</span><span style=color:#2aa198>024</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.18:50052, client: 172.18. 96.18, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>106</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>16</span><span style=color:#719e07>:</span><span style=color:#2aa198>29</span><span style=color:#719e07>:</span><span style=color:#2aa198>02</span><span style=color:#2aa198>9</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.22:50052, client: 172.18. 96.22, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>107</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>16</span><span style=color:#719e07>:</span><span style=color:#2aa198>34</span><span style=color:#719e07>:</span><span style=color:#2aa198>034</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.18:50052, client: 172.18. 96.18, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>108</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>16</span><span style=color:#719e07>:</span><span style=color:#2aa198>39</span><span style=color:#719e07>:</span><span style=color:#2aa198>03</span><span style=color:#2aa198>9</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.22:50052, client: 172.18. 96.22, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>=====================</span> dubbo invoke <span style=color:#2aa198>109</span> end <span style=color:#719e07>======================</span>
</span></span><span style=display:flex><span><span style=color:#719e07>[</span><span style=color:#2aa198>10</span><span style=color:#719e07>/</span><span style=color:#2aa198>08</span><span style=color:#719e07>/</span><span style=color:#2aa198>22</span> <span style=color:#2aa198>07</span><span style=color:#719e07>:</span><span style=color:#2aa198>16</span><span style=color:#719e07>:</span><span style=color:#2aa198>44</span><span style=color:#719e07>:</span><span style=color:#2aa198>044</span> UTC<span style=color:#719e07>]</span> main INFO action<span style=color:#719e07>.</span>GreetingServiceConsumer<span style=color:#719e07>:</span> consumer Unary reply <span style=color:#719e07>&lt;-</span>message<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;hello, service mesh, response from provider-v1: 172.18.96.18:50052, client: 172.18. 96.18, local: dubbo-samples-mesh-provider, remote: null, isProviderSide: true&#34;</span>
</span></span></code></pre></div><h3 id=36-view-dashboard>3.6 View dashboard</h3><p>See <a href=https://istio.io/latest/docs/setup/getting-started/#dashboard>How to start the dashboard</a> on the Istio official website.</p><h2 id=4-modified-example>4 Modified Example</h2><blockquote><ol><li>Modifying the example is not a necessary step, this section is for readers who want to adjust the code and see the deployment effect.</li><li>Note that the project source code storage path must be in English, otherwise protobuf compilation will fail.</li></ol></blockquote><p>Modify Dubbo Provider configuration <code>dubbo-provider.properties</code></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#586e75># provider</span>
</span></span><span style=display:flex><span>dubbo.application.name<span style=color:#719e07>=</span><span style=color:#2aa198>dubbo-samples-mesh-provider</span>
</span></span><span style=display:flex><span>dubbo.application.metadataServicePort<span style=color:#719e07>=</span><span style=color:#2aa198>20885</span>
</span></span><span style=display:flex><span>dubbo.registry.address<span style=color:#719e07>=</span><span style=color:#2aa198>N/A</span>
</span></span><span style=display:flex><span>dubbo.protocol.name<span style=color:#719e07>=</span><span style=color:#2aa198>tri</span>
</span></span><span style=display:flex><span>dubbo.protocol.port<span style=color:#719e07>=</span><span style=color:#2aa198>50052</span>
</span></span><span style=display:flex><span>dubbo.application.qosEnable<span style=color:#719e07>=</span><span style=color:#2aa198>true</span>
</span></span><span style=display:flex><span><span style=color:#586e75># In order for the Kubernetes cluster to access the probe normally, it is necessary to enable QOS to allow remote access, which may bring security Risk, please carefully evaluate before opening</span>
</span></span><span style=display:flex><span>dubbo.application.qosAcceptForeignIp<span style=color:#719e07>=</span><span style=color:#2aa198>true</span>
</span></span></code></pre></div><p>Modify Dubbo Consumer configuration <code>dubbo-consumer.properties</code></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#586e75># consumer</span>
</span></span><span style=display:flex><span>dubbo.application.name<span style=color:#719e07>=</span><span style=color:#2aa198>dubbo-samples-mesh-consumer</span>
</span></span><span style=display:flex><span>dubbo.application.metadataServicePort<span style=color:#719e07>=</span><span style=color:#2aa198>20885</span>
</span></span><span style=display:flex><span>dubbo.registry.address<span style=color:#719e07>=</span><span style=color:#2aa198>N/A</span>
</span></span><span style=display:flex><span>dubbo.protocol.name<span style=color:#719e07>=</span><span style=color:#2aa198>tri</span>
</span></span><span style=display:flex><span>dubbo.protocol.port<span style=color:#719e07>=</span><span style=color:#2aa198>20880</span>
</span></span><span style=display:flex><span>dubbo.consumer.timeout<span style=color:#719e07>=</span><span style=color:#2aa198>30000</span>
</span></span><span style=display:flex><span>dubbo.application.qosEnable<span style=color:#719e07>=</span><span style=color:#2aa198>true</span>
</span></span><span style=display:flex><span><span style=color:#586e75># In order for the Kubernetes cluster to access the probe normally, it is necessary to enable QOS to allow remote access. This operation may bring security risks. Please evaluate it carefully before opening it</span>
</span></span><span style=display:flex><span>dubbo.application.qosAcceptForeignIp<span style=color:#719e07>=</span><span style=color:#2aa198>true</span>
</span></span><span style=display:flex><span><span style=color:#586e75># Flag to enable mesh sidecar proxy mode</span>
</span></span><span style=display:flex><span>dubbo.consumer.meshEnable<span style=color:#719e07>=</span><span style=color:#2aa198>true</span>
</span></span></code></pre></div><p>After completing the code modification, package the image through the Dockerfile provided by the project</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#586e75># Package and push the image</span>
</span></span><span style=display:flex><span>mvn compile jib:build
</span></span></code></pre></div><blockquote><p>The Jib plugin will automatically package and publish the image. Note that for local development, you need to change the docker registry organization apache/dubbo-demo in the jib plug-in configuration to an organization with your own authority (including dubboteam in other kubernetes manifests to ensure that kubernetes deploys your own customized image) , if you encounter jib plug-in authentication problems, please refer to [corresponding link](<a href=https://github.com/GoogleContainerTools/jib/blob/master/docs/faq.md#what-should-i-do-when-the->https://github.com/GoogleContainerTools/jib/blob/master/docs/faq.md#what-should-i-do-when-the-</a> registry-responds-with-unauthorized) to configure docker registry authentication information.
You can specify <code>mvn compile jib:build -Djib.to.auth.username=x -Djib.to.auth.password=x -Djib.from.auth.username=x -Djib.from.auth directly on the command line .username=x</code>, or use docker-credential-helper.</p></blockquote><h2 id=5-common-commands>5 Common commands</h2><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#586e75># dump current Envoy configs</span>
</span></span><span style=display:flex><span>kubectl <span style=color:#b58900>exec</span> -it <span style=color:#2aa198>${</span><span style=color:#268bd2>your</span> pod id<span style=color:#2aa198>}</span> -c istio-proxy curl http://127.0.0.1:15000/config_dump &gt; config_dump
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># Enter the istio-proxy container</span>
</span></span><span style=display:flex><span>kubectl <span style=color:#b58900>exec</span> -it <span style=color:#2aa198>${</span><span style=color:#268bd2>your</span> pod id<span style=color:#2aa198>}</span> -c istio-proxy -- /bin/bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># View container logs</span>
</span></span><span style=display:flex><span>kubectl logs <span style=color:#2aa198>${</span><span style=color:#268bd2>your</span> pod id<span style=color:#2aa198>}</span> -n <span style=color:#2aa198>${</span><span style=color:#268bd2>your</span> namespace<span style=color:#2aa198>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl logs <span style=color:#2aa198>${</span><span style=color:#268bd2>your</span> pod id<span style=color:#2aa198>}</span> -n <span style=color:#2aa198>${</span><span style=color:#268bd2>your</span> namespace<span style=color:#2aa198>}</span> -c istio-proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># Enable automatic sidecar injection</span>
</span></span><span style=display:flex><span>kubectl label namespace <span style=color:#2aa198>${</span><span style=color:#268bd2>your</span> namespace<span style=color:#2aa198>}</span> istio-injection<span style=color:#719e07>=</span>enabled --overwrite
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># Turn off automatic sidecar injection</span>
</span></span><span style=display:flex><span>kubectl label namespace <span style=color:#2aa198>${</span><span style=color:#268bd2>your</span> namespace<span style=color:#2aa198>}</span> istio-injection<span style=color:#719e07>=</span>disabled --overwrite
</span></span></code></pre></div><h2 id=6-notes>6 Notes</h2><ol><li>In the example, both the producer and the consumer belong to the same namespace; if you need to call a provider of a different namespace, you need to configure it as follows (<strong>dubbo version>=3.1.2</strong>):</li></ol><p>Annotation method:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#268bd2>@DubboReference</span><span style=color:#719e07>(</span>providedBy <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;istio-demo-dubbo-producer&#34;</span><span style=color:#719e07>,</span> providerPort <span style=color:#719e07>=</span> <span style=color:#2aa198>20885</span><span style=color:#719e07>,</span> providerNamespace <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;istio-demo&#34;</span><span style=color:#719e07>)</span>
</span></span></code></pre></div><p>xml way</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#268bd2>&lt;dubbo:reference</span> id=<span style=color:#2aa198>&#34;demoService&#34;</span> check=<span style=color:#2aa198>&#34;true&#34;</span>
</span></span><span style=display:flex><span>                   interface=<span style=color:#2aa198>&#34;org.apache.dubbo.samples.basic.api.DemoService&#34;</span>
</span></span><span style=display:flex><span>                   provider-port=<span style=color:#2aa198>&#34;20885&#34;</span>
</span></span><span style=display:flex><span>                   provided-by=<span style=color:#2aa198>&#34;istio-dubbo-producer&#34;</span>
</span></span><span style=display:flex><span>                   provider-namespace=<span style=color:#2aa198>&#34;istio-demo&#34;</span><span style=color:#268bd2>/&gt;</span>
</span></span></code></pre></div><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/apache/dubbo-website/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/apache/dubbo-website/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified January 2, 2023: <a href=https://github.com/apache/dubbo-website/commit/df1149ea48d56f80304f5f87195b31941ec16664>Update homepage (#1799) (df1149e)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Dubbo mailing list archive" aria-label="Dubbo mailing list archive"><a class=text-white target=_blank rel="noopener noreferrer" href=https://lists.apache.org/list.html?dev@dubbo.apache.org><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/apache/dubbo><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Subscribe to mailing list" aria-label="Subscribe to mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=mailto:dev-subscribe@dubbo.apache.org><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation. All Rights Reserved</small></div></div></div></footer><div class="row pt-2 pb-2"><div class="container-fluid mx-sm-5"><div class=text-center id=my-footer><img style=float:left src=/imgs/apache_logo.png><ul><li><a href=https://www.apache.org>Foundation</a></li><li><a href=https://www.apache.org/licenses/>License</a></li><li><a href=https://www.apache.org/security/>Security</a></li><li><a href=https://www.apache.org/events/current-event>Events</a></li><li><a href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li><li><a href=https://privacy.apache.org/policies/privacy-policy-public.html>Privacy</a></li><li><a href=https://www.apache.org/foundation/thanks.html>Thanks</a></li></ul></div></div></div></div><script src=/js/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<script src=/js/main.min.9f304eb79b67eb331e2b22923c361575b563af25c0fd56279cf20f3a2417cff4.js integrity="sha256-nzBOt5tn6zMeKyKSPDYVdbVjryXA/VYnnPIPOiQXz/Q=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script>docsearch({appId:"L5F4T9F0I1",apiKey:"364ae307e1da9d02b2335675e9db1eb1",indexName:"apache_dubbo",container:"#docsearch",debug:!1}),docsearch({appId:"L5F4T9F0I1",apiKey:"364ae307e1da9d02b2335675e9db1eb1",indexName:"apache_dubbo",container:"#docsearch_zh_home",debug:!1})</script></body></html>